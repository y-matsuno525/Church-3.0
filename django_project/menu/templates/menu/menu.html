{% extends "base.html" %}

{% block main %}
<div class="container my-5">
    <div class="row">
        <!-- 左側のページ一覧 -->
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <!-- ドロップダウンメニュー -->
                <select name="example" class="form-select my-3">
                    <option value="JCO">JCO</option>
                    <option value="KJV">KJV</option>
                    <option value="ASV">ASV</option>
                </select>
                <!-- 論文作成タイトル -->
                <h3 class="text-center mt-3">論文作成</h3>
                <!-- 書籍一覧 -->
                <ul class="nav flex-column">
                    {% for book in books %}
                        <li class="nav-item">
                            <a class="nav-link book-link" href="#" data-book-id="{{ book.id }}">{{ book.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </nav>

        <!-- メインコンテンツ -->
        <div class="col-md-10">
            <!-- ヘッダーセクション -->
            <div class="text-center mb-4">
                <h1 class="display-5 fw-bold">Menu</h1>
            </div>
            <!-- メインコンテンツのプレースホルダー -->
            <div id="main-content">
                <p>左のメニューから読みたい本を選択してください</p>
            </div>
        </div>
    </div>
</div>

<!--掲示板ポップアップ表示-->
<div id="forum-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid black; padding: 20px; z-index: 1000;">
    <button class="close" style="position: absolute; top: 10px; right: 10px;">閉じる</button>
    <div class="content">
        <!-- 掲示板の内容がここに挿入される -->
    </div>
</div>

<!-- jQueryを使用 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>   
    //書の表示
    //.readyでHTML読み込みが完了するまで待機する
    $(document).ready(function () {
        // 書名リンクがクリックされたときのイベント
        $(".book-link").on("click", function (e) {
            e.preventDefault(); // デフォルトのリンク動作を無効化

            var bookId = $(this).data("book-id"); // 書籍IDを取得

            // Ajaxリクエストを送信
            $.ajax({
                url: "{% url 'menu:get_verses' %}", // 書の内容を取得するビューのURL（後述）
                method: "GET",
                data: {
                    book_id: bookId // 書籍IDを送信
                },
                success: function (response) {
                    if (response.html) {
                    // メインコンテンツエリアに書の内容を表示
                    $("#main-content").html(response.html);
                    } else {
                        $("#main-content").html("<p>内容を取得できませんでした。</p>");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("エラーが発生しました:", error);
                    $("#main-content").html("<p>内容を取得できませんでした。</p>");
                }
            });
        });
    });

    //掲示板のポップアップを表示
    $(document).ready(function () {
        // 掲示板ボタンがクリックされたとき
        $(".forum-button").on("click", function (e) {
            e.preventDefault(); // デフォルトの動作を無効化

            var verseId = $(this).data("verse-id"); // Verse IDを取得

            // Ajaxリクエストを送信して掲示板内容を取得
            $.ajax({
                url: "{% url 'menu:get_forum_posts' %}", // 掲示板ビューのURL
                method: "GET",
                data: {
                    verse_id: verseId
                },
                success: function (response) {
                    if (response.html) {
                        // ポップアップに掲示板内容を表示
                        $("#forum-popup .content").html(response.html);
                        $("#forum-popup").show(); // ポップアップを表示
                    } else {
                        alert("掲示板の内容を取得できませんでした。");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("エラーが発生しました:", error);
                    alert("掲示板の内容を取得できませんでした。");
                }
            });
        });

        // ポップアップを閉じるボタン
        $("#forum-popup .close").on("click", function () {
            $("#forum-popup").hide(); // ポップアップを非表示
        });
    });
</script>
{% endblock %}
